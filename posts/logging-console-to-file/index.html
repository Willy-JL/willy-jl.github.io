<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Logging Console to File" /><meta property="og:locale" content="en_US" /><meta name="description" content="Whether you are making a program with a user interface or a commandline application, being able to catch and store console output is often crucial both for catching bugs and error messages but also to keep track of what is happening in your program." /><meta property="og:description" content="Whether you are making a program with a user interface or a commandline application, being able to catch and store console output is often crucial both for catching bugs and error messages but also to keep track of what is happening in your program." /><link rel="canonical" href="https://willy-jl.github.io/posts/logging-console-to-file/" /><meta property="og:url" content="https://willy-jl.github.io/posts/logging-console-to-file/" /><meta property="og:site_name" content="WillyJL’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-07-15T21:44:21+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Logging Console to File" /><meta name="twitter:site" content="@WillyJL_" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"Whether you are making a program with a user interface or a commandline application, being able to catch and store console output is often crucial both for catching bugs and error messages but also to keep track of what is happening in your program.","url":"https://willy-jl.github.io/posts/logging-console-to-file/","headline":"Logging Console to File","dateModified":"2021-07-17T18:18:41+02:00","datePublished":"2021-07-15T21:44:21+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://willy-jl.github.io/posts/logging-console-to-file/"},"@type":"BlogPosting","@context":"https://schema.org"}</script><title>Logging Console to File | WillyJL's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="WillyJL's Blog"><meta name="application-name" content="WillyJL's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://cdn.discordapp.com/avatars/285519042163245056/a_9594f0d3559cd3c3d64791df274f80f5.gif" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">WillyJL's Blog</a></div><div class="site-subtitle font-italic">Coding tips and tricks from a passionate coder</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about-me/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-briefcase ml-xl-3 mr-xl-3 unloaded"></i> <span>PROJECTS</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://linktr.ee/WillyJL" aria-label="linktree" class="order-3" target="_blank" rel="noopener"> <i class="fas fa-user"></i> </a> <a href="https://github.com/Willy-JL" aria-label="github" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['willy.leslie','icloud.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Logging Console to File</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Logging Console to File</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> WillyJL </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Jul 15, 2021, 9:44 PM +0200" prep="on" > Jul 15 <i class="unloaded">2021-07-15T21:44:21+02:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sat, Jul 17, 2021, 6:18 PM +0200" prefix="Updated " > Jul 17 <i class="unloaded">2021-07-17T18:18:41+02:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1277 words">7 min</span></div></div><div class="post-content"><p>Whether you are making a program with a user interface or a commandline application, being able to catch and store console output is often crucial both for catching bugs and error messages but also to keep track of what is happening in your program.</p><p>With Python I haven’t found much on the internet about achieving this, apart from a few posts talking about overriding <code class="language-plaintext highlighter-rouge">sys.stdout</code> to also write to a file, but not everything gets written to the standard output.</p><p><br /></p><h2 id="the-code">The code</h2><p>This snippet is designed to be used as a standalone module, that when imported into your script will start logging the console output to a log file.</p><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre><td class="rouge-code"><pre><span class="c1"># logger.py
</span><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="n">_stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span>
<span class="n">_stderr</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">stderr</span>
<span class="n">_stdin</span>  <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">stdin</span>

<span class="n">_pause_file_output</span> <span class="o">=</span> <span class="bp">False</span>


<span class="k">def</span> <span class="nf">_file_write</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">no_color</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">_pause_file_output</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">no_color</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="s">"</span><span class="se">\\</span><span class="s">x1b\[38;2;\d\d?\d?;\d\d?\d?;\d\d?\d?m"</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="s">"</span><span class="se">\\</span><span class="s">x1b\[\d\d?\d?m"</span><span class="p">,</span>                        <span class="s">""</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s">"log.txt"</span><span class="p">,</span> <span class="s">"a"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">log</span><span class="p">:</span>
        <span class="n">log</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">__stdout_override</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="n">_stdout</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="n">_file_write</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_stdout</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">__stderr_override</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="n">_stderr</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="n">_file_write</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_stderr</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">__stdin_override</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">readline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">_stdin</span><span class="p">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">_file_write</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">no_color</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">message</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">"fileno"</span><span class="p">:</span> <span class="k">raise</span> <span class="nb">AttributeError</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_stdin</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="o">@</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">pause_file_output</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">_pause_file_output</span>
    <span class="n">_pause_file_output</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">yield</span>
    <span class="n">_pause_file_output</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">pause</span> <span class="o">=</span> <span class="n">pause_file_output</span>


<span class="nb">open</span><span class="p">(</span><span class="s">"log.txt"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">).</span><span class="n">close</span><span class="p">()</span>

<span class="n">sys</span><span class="p">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">__stdout_override</span><span class="p">()</span>
<span class="n">sys</span><span class="p">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">__stderr_override</span><span class="p">()</span>
<span class="n">sys</span><span class="p">.</span><span class="n">stdin</span>  <span class="o">=</span> <span class="n">__stdin_override</span> <span class="p">()</span>
</pre></table></code></div></div><h2 id="how-it-works">How it works</h2><p>Looking at this wall of code it might look intimidating at first but really it’s quite simple.</p><p>First of all we copy the original streams onto some internal variables:</p><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">_stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span>
<span class="n">_stderr</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">stderr</span>
<span class="n">_stdin</span>  <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">stdin</span>
</pre></table></code></div></div><p>This way we preserve a copy of the original functionality used internally by Python</p><p><br /></p><p>Then we define the function that actually handles writing to the log file:</p><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">_file_write</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">no_color</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">_pause_file_output</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">no_color</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="s">"</span><span class="se">\\</span><span class="s">x1b\[38;2;\d\d?\d?;\d\d?\d?;\d\d?\d?m"</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="s">"</span><span class="se">\\</span><span class="s">x1b\[\d\d?\d?m"</span><span class="p">,</span>                        <span class="s">""</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s">"log.txt"</span><span class="p">,</span> <span class="s">"a"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">log</span><span class="p">:</span>
        <span class="n">log</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</pre></table></code></div></div><p>Here we instantly return if file output is paused, and then optionally remove color codes from the message. This cleans up the log file avoiding that color escape codes clutter the file, making reading the output harder. These color codes most commonly look like <code class="language-plaintext highlighter-rouge">\x1b[34m</code> where <code class="language-plaintext highlighter-rouge">34</code> is the actual color code, in this case blue (<code class="language-plaintext highlighter-rouge">colorama</code> uses these types of codes), or <code class="language-plaintext highlighter-rouge">\x1b[38;2;255;255;255m</code> where <code class="language-plaintext highlighter-rouge">255;255;255</code> are the RGB values. And finally we actually write the clean message to the <code class="language-plaintext highlighter-rouge">log.txt</code> file.</p><p><br /></p><p>Next up are the 3 crucial parts of the script (I didn’t include <code class="language-plaintext highlighter-rouge">stderr</code> here since it’s the exact same as <code class="language-plaintext highlighter-rouge">stdout</code>, just with different variable names):</p><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">__stdout_override</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="n">_stdout</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="n">_file_write</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_stdout</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></table></code></div></div><p>What happens here is that when the write method gets called, it calls back to the original <code class="language-plaintext highlighter-rouge">sys.stdout.write</code> functionality (remember that we backed it up inside <code class="language-plaintext highlighter-rouge">_stdout</code>) and afterwards we also write the same message to the log file. The <code class="language-plaintext highlighter-rouge">__getattr__</code> method is required since we want to keep all the other original functionality of the streams, simply modifying what we need to log output to the file, and all it does is refer back to the original stream we backed up at the start.</p><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">__stdin_override</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">readline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">_stdin</span><span class="p">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">_file_write</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">no_color</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">message</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">"fileno"</span><span class="p">:</span> <span class="k">raise</span> <span class="nb">AttributeError</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_stdin</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></table></code></div></div><p>With <code class="language-plaintext highlighter-rouge">sys.stdin</code> however we need to do things differently, since <code class="language-plaintext highlighter-rouge">stdin</code> is not an output stream but an input stream, it is where the user can type to give input to the program. Because of this we override the <code class="language-plaintext highlighter-rouge">readline</code> method, which also needs to return the message that was read. When writing to the file we also tell it to not remove color codes, since this is user input and if for whatever reason the user inputs a color escape code, we would still want that in the log.</p><p>In this case, however, there is also one more issue: the builtin <code class="language-plaintext highlighter-rouge">input()</code> function that we use to get input from the user by default tries to avoid using <code class="language-plaintext highlighter-rouge">sys.stdin.readline</code> and instead gets the stream number identifier with <code class="language-plaintext highlighter-rouge">sys.stdin.fileno</code> and then handles reading in C code. We don’t want this however, since that means we can’t log user input to the file. To overcome this we block access to <code class="language-plaintext highlighter-rouge">sys.stdin.fileno</code> by raising an <code class="language-plaintext highlighter-rouge">AttributeError</code> and this way we force <code class="language-plaintext highlighter-rouge">input()</code> to fall back to using our modified version of <code class="language-plaintext highlighter-rouge">sys.stdin.readline</code>.</p><p><br /></p><p>The next block is an interesting one:</p><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="o">@</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">pause_file_output</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">_pause_file_output</span>
    <span class="n">_pause_file_output</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">yield</span>
    <span class="n">_pause_file_output</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">pause</span> <span class="o">=</span> <span class="n">pause_file_output</span>
</pre></table></code></div></div><p>As you might have noticed, this is the only object that doesn’t start with a <code class="language-plaintext highlighter-rouge">_</code> as this is intended to be used by the user (in case you didn’t know, a single <code class="language-plaintext highlighter-rouge">_</code> in front of variable/function/class names indicates that it is not intended to be used, but you can if you really have to, while a double <code class="language-plaintext highlighter-rouge">__</code> indicates mostly the same thing but to a higher degree, you should really avoid using internal members marked with two <code class="language-plaintext highlighter-rouge">__</code>). The purpose of this function is to allow the file output to be paused inside a <code class="language-plaintext highlighter-rouge">with ...():</code> block, meaning that while code inside such block is being executed, nothing will be output to the file. More on this later on.</p><p><br /></p><p>Now that we set everything up, we just need to apply our overrides:</p><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">open</span><span class="p">(</span><span class="s">"log.txt"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">).</span><span class="n">close</span><span class="p">()</span>
</pre></table></code></div></div><p>First of all we wipe the log file, so that every program run gets a clean log.</p><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">sys</span><span class="p">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">__stdout_override</span><span class="p">()</span>
<span class="n">sys</span><span class="p">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">__stderr_override</span><span class="p">()</span>
<span class="n">sys</span><span class="p">.</span><span class="n">stdin</span>  <span class="o">=</span> <span class="n">__stdin_override</span> <span class="p">()</span>
</pre></table></code></div></div><p>And finally we apply our overrides to the actual internal streams so that they become active and we start getting output in the log file.</p><p><br /></p><h2 id="how-to-use-it">How to use it</h2><p>Now that we understand how it all works, it’s time for the fun part: actually using it!</p><p>For the best results I suggest you activate the logger as soon as possible inside your program, so that you start logging console output right from the start.</p><div lang="python" class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">modules</span> <span class="kn">import</span> <span class="n">logger</span>
<span class="c1"># First we import our logger.py, which automatically sets everything up
</span>
<span class="c1"># Do stuff
</span>
<span class="k">print</span><span class="p">(</span><span class="s">"this will show up in your log file!"</span><span class="p">)</span>
<span class="c1"># Anything that gets output to the console will also be saved to the log file
</span>
<span class="k">with</span> <span class="n">logger</span><span class="p">.</span><span class="n">pause_file_output</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"this will not be saved in the log file!"</span><span class="p">)</span>
    <span class="c1"># You can also use logger.pause() for short!
</span>
<span class="n">msg</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"user input also gets saved: "</span><span class="p">)</span>
<span class="c1"># And you will see what you typed into the console right in your log file!
</span>
<span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="c1"># This will cause an exception, but that will be caught and you will be
# able to see it in the log file!
</span></pre></table></code></div></div><p><br /></p><h2 id="updates-and-support">Updates and support</h2><p>In the future if I make updates or find improvements for this script I will likely update it on <a href="https://gist.github.com/Willy-JL/3eaa171144b3bb0a4602c7b537f90036">this gist</a>.</p><p>If you have doubts or issues, feel free to contact me! You can either use the comment section below or message me using the links at the bottom of the sidebar!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/python/'>Python</a>, <a href='/categories/snippets/'>Snippets</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/python/" class="post-tag no-text-decoration" >python</a> <a href="/tags/snippet/" class="post-tag no-text-decoration" >snippet</a> <a href="/tags/console/" class="post-tag no-text-decoration" >console</a> <a href="/tags/logging/" class="post-tag no-text-decoration" >logging</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Logging Console to File - WillyJL's Blog&url=https://willy-jl.github.io/posts/logging-console-to-file/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Logging Console to File - WillyJL's Blog&u=https://willy-jl.github.io/posts/logging-console-to-file/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Logging Console to File - WillyJL's Blog&url=https://willy-jl.github.io/posts/logging-console-to-file/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/events-and-callbacks/">Events and Callbacks</a><li><a href="/posts/logging-console-to-file/">Logging Console to File</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/code-better/">code better</a> <a class="post-tag" href="/tags/console/">console</a> <a class="post-tag" href="/tags/events-and-callbacks/">events and callbacks</a> <a class="post-tag" href="/tags/logging/">logging</a> <a class="post-tag" href="/tags/snippet/">snippet</a> <a class="post-tag" href="/tags/tips/">tips</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/events-and-callbacks/"><div class="card-body"> <span class="timeago small" > Jul 17 <i class="unloaded">2021-07-17T18:22:04+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Events and Callbacks</h3><div class="text-muted small"><p> To be honest what I’m about to explain in this post is very intuitive but I had never thought about it this way and when I finally did I realized how much stuff that i wrote could be done in a much...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <span class="btn btn-outline-primary disabled" prompt="Older"><p>-</p></span> <a href="/posts/events-and-callbacks/" class="btn btn-outline-primary" prompt="Newer"><p>Events and Callbacks</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//willyjls-blog.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'Logging Console to File'; this.page.url = 'https://willy-jl.github.io/posts/logging-console-to-file/'; this.page.identifier = '/posts/logging-console-to-file/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://linktr.ee/WillyJL">WillyJL</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/code-better/">code better</a> <a class="post-tag" href="/tags/console/">console</a> <a class="post-tag" href="/tags/events-and-callbacks/">events and callbacks</a> <a class="post-tag" href="/tags/logging/">logging</a> <a class="post-tag" href="/tags/snippet/">snippet</a> <a class="post-tag" href="/tags/tips/">tips</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://willy-jl.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script>
